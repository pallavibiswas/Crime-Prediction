<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Prediction Level</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        .pagination {
            margin: 20px 0;
            text-align: center;
        }
        .pagination button {
            padding: 10px;
            margin: 0 5px;
            border: 1px solid #ddd;
            background-color: #f4f4f4;
            cursor: pointer;
        }
        .pagination button.disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
    </style>
</head>
<body class="container">
    <h1 class="mt-4">Select Incident</h1>
    <form>
        <div class="mb-3">
            <label for="location" class="form-label">Location:</label>
            <select id="location" class="form-select">
                <option value="">--Select a Location--</option>
                {% for location in locations %}
                    <option value="{{ location }}">{{ location }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="offense-type" class="form-label">Type of Offense:</label>
            <select id="offense-type" class="form-select" disabled>
                <option value="">--Select a Type of Offense--</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="incident" class="form-label">Type of Incident:</label>
            <select id="incident" class="form-select" disabled>
                <option value="">--Select a Type of Incident--</option>
            </select>
        </div>
        <button type="button" id="submit-btn" class="btn btn-primary" disabled>Submit</button>
    </form>
    <div id="table-container" class="mt-4">
        <table id="predictions-table" class="table table-striped">
            <thead>
                <tr id="table-head"></tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
        <div class="pagination" id="pagination-container">
            <button id="prev-page" class="disabled" onclick="changePage(-1)">Previous</button>
            <button id="next-page" class="disabled" onclick="changePage(1)">Next</button>
        </div>
    </div>
    <script>
        let currentPage = 1;
        let rowsPerPage = 25;
        let data = [];

        document.getElementById('location').addEventListener('change', function() {
            const location = this.value;
            if (location) {
                fetch(`/location/${location}`).then(response => response.json()).then(offense_types => {
                    const offenseTypeSelect = document.getElementById('offense-type');
                    offenseTypeSelect.innerHTML = '<option value="">--Select a Type of Offense--</option>';
                    offense_types.forEach(offense_type => {
                        offenseTypeSelect.innerHTML += `<option value="${offense_type}">${offense_type}</option>`;
                    });
                    offenseTypeSelect.disabled = false;
                });
            } else {
                document.getElementById('offense-type').disabled = true;
                document.getElementById('incident').disabled = true;
                document.getElementById('submit-btn').disabled = true;
            }
        });

        document.getElementById('offense-type').addEventListener('change', function() {
            const location = document.getElementById('location').value;
            const offenseType = this.value;
            if (location && offenseType) {
                fetch(`/offense/${location}/${offenseType}`).then(response => response.json()).then(incidents => {
                    const incidentSelect = document.getElementById('incident');
                    incidentSelect.innerHTML = '<option value="">--Select a Type of Incident--</option>';
                    incidents.forEach(incident => {
                        incidentSelect.innerHTML += `<option value="${incident}">${incident}</option>`;
                    });
                    incidentSelect.disabled = false;
                });
            } else {
                document.getElementById('incident').disabled = true;
                document.getElementById('submit-btn').disabled = true;
            }
        });

        document.getElementById('incident').addEventListener('change', function() {
            const location = document.getElementById('location').value;
            const offenseType = document.getElementById('offense-type').value;
            const incident = this.value;
            if (location && offenseType && incident) {
                document.getElementById('submit-btn').disabled = false;
                document.getElementById('submit-btn').onclick = function() {
                    window.location.href = `/incident/${location}/${offenseType}/${incident}`;
                };
            } else {
                document.getElementById('submit-btn').disabled = true;
            }
        });

        function changePage(direction) {
            const totalPages = Math.ceil(data.length / rowsPerPage);
            if ((direction === -1 && currentPage === 1) || (direction === 1 && currentPage === totalPages)) {
                return;
            }
            currentPage += direction;
            displayTable();
            updatePagination();
        }

        function displayTable() {
            const tableHead = document.getElementById('table-head');
            const tableBody = document.getElementById('table-body');
            tableHead.innerHTML = '';
            tableBody.innerHTML = '';

            if (data.length === 0) return;

            const columns = Object.keys(data[0]);
            const headerRow = document.createElement('tr');
            columns.forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                headerRow.appendChild(th);
            });
            tableHead.appendChild(headerRow);

            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedData = data.slice(start, end);

            paginatedData.forEach(row => {
                const tableRow = document.createElement('tr');
                columns.forEach(col => {
                    const td = document.createElement('td');
                    td.textContent = row[col];
                    tableRow.appendChild(td);
                });
                tableBody.appendChild(tableRow);
            });
        }

        function updatePagination() {
            const totalPages = Math.ceil(data.length / rowsPerPage);

            document.getElementById('prev-page').classList.toggle('disabled', currentPage === 1);
            document.getElementById('next-page').classList.toggle('disabled', currentPage === totalPages);
        }
    </script>
</body>
</html>